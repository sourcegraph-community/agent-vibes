# Apify Pipeline – Code vs Documentation Alignment (2025-10-01)

## Summary
All primary references now reflect the Supabase Edge Function architecture, Gemini 2.5 model usage, and the updated Apify throttling defaults. The remaining follow-ups focus on operational maturity (alerting, load tests) rather than documentation drift.

## Alignment Highlights
- **Sentiment Processing:** `/api/process-sentiments` proxies to the Supabase Edge Function [`sentiment-processor`](file:///home/prinova/CodeProjects/agent-vibes/supabase/functions/sentiment-processor/index.ts); docs in [`specification.md`](file:///home/prinova/CodeProjects/agent-vibes/docs/apify-pipeline/specification.md#L37-L48), [`implementation-plan.md`](file:///home/prinova/CodeProjects/agent-vibes/docs/apify-pipeline/implementation-plan.md#L289-L333), and [`overview.md`](file:///home/prinova/CodeProjects/agent-vibes/docs/apify-pipeline/overview.md#L8-L21) now describe the Edge-first path and optional fallback.
- **Gemini Model:** Both [`SentimentProcessorJob.ts`](file:///home/prinova/CodeProjects/agent-vibes/src/ApifyPipeline/Background/Jobs/SentimentProcessor/SentimentProcessorJob.ts#L25-L67) and [`GeminiClient.ts`](file:///home/prinova/CodeProjects/agent-vibes/src/ApifyPipeline/ExternalServices/Gemini/GeminiClient.ts#L5-L216) default to `gemini-2.5-flash`, matching the documentation updates.
- **Append-Only Status:** [`specification.md`](file:///home/prinova/CodeProjects/agent-vibes/docs/apify-pipeline/specification.md#L32-L38) now explicitly states that status changes create new revisions, aligning with [`TweetSentimentsRepository.ts`](file:///home/prinova/CodeProjects/agent-vibes/src/ApifyPipeline/DataAccess/Repositories/TweetSentimentsRepository.ts#L24-L198).
- **Cron & Throttling:** The ingestion job defaults to a 5-minute cooldown per Apify batch ([`TweetCollectorJob.ts`](file:///home/prinova/CodeProjects/agent-vibes/src/ApifyPipeline/Background/Jobs/TweetCollector/TweetCollectorJob.ts#L23-L156)), and docs cite the policy ([`specification.md §3.1`](file:///home/prinova/CodeProjects/agent-vibes/docs/apify-pipeline/specification.md#L16-L23)).
- **Environment Variables:** [`env.ts`](file:///home/prinova/CodeProjects/agent-vibes/src/ApifyPipeline/Infrastructure/Config/env.ts#L1-L120) exposes `SUPABASE_FUNCTIONS_URL` and `SUPABASE_SERVICE_ROLE_KEY`; the same names appear in [`specification.md §8`](file:///home/prinova/CodeProjects/agent-vibes/docs/apify-pipeline/specification.md#L145-L149) and [`implementation-plan.md` Milestone 3](file:///home/prinova/CodeProjects/agent-vibes/docs/apify-pipeline/implementation-plan.md#L286-L333).
- **Routing Narrative:** [`specification.md`](file:///home/prinova/CodeProjects/agent-vibes/docs/apify-pipeline/specification.md#L128-L134) and [`web-results/vercel-cron.md`](file:///home/prinova/CodeProjects/agent-vibes/docs/apify-pipeline/web-results/vercel-cron.md#L5-L16) make clear that Vercel Cron calls in-project routes which in turn call external services.
- **Dashboard Access:** [`implementation-plan.md`](file:///home/prinova/CodeProjects/agent-vibes/docs/apify-pipeline/implementation-plan.md#L286-L333) notes the server-only service-role usage, consistent with [`app/dashboard/page.tsx`](file:///home/prinova/CodeProjects/agent-vibes/app/dashboard/page.tsx#L5-L152).

## Outstanding Follow-Ups
1. **Observability:** Implement alerting/metrics for Supabase Edge Function failures and fallback invocations (tracked as TODOs in [`implementation-plan.md`](file:///home/prinova/CodeProjects/agent-vibes/docs/apify-pipeline/implementation-plan.md#L308-L333)).
2. **Load Testing:** Execute a Gemini mock load test before production rollout, as flagged in Milestone 3.
3. **Integration Coverage:** Add automated tests that exercise the Edge Function proxy path (local Supabase + `/api/process-sentiments`).
4. **Documentation Maintenance:** Continue mirroring any future configuration changes to the Edge Function or throttling defaults in the three primary docs above.
